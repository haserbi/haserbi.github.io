<!DOCTYPE html>
<html lang="en">
  
  <head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="shortcut icon" href="./images/favicon.ico">
    <link rel="favicon" href="./images/favicon.ico">
    <!-- Bootstrap v5.0 -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.0.0-beta1/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-giJF6kkoqNQ00vy+HMDP7azOuL0xtbfIcaT9wjKHr8RbDVddVHyTfAAsrekwKmP1" crossorigin="anonymous">
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.0.0-beta1/dist/js/bootstrap.bundle.min.js" integrity="sha384-ygbV9kiqUc6oa4msXn9868pTtWMgiQaeYH7/t7LECLbyPA2x65Kgf80OJFdroafW" crossorigin="anonymous"></script>
    <script class="jsbin" src="https://ajax.googleapis.com/ajax/libs/jquery/1/jquery.min.js"></script>
    <script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
    <!-- import CSS -->
    <link rel="stylesheet" href="https://unpkg.com/element-ui/lib/theme-chalk/index.css">
    <link rel="stylesheet" href="./css/reset.css">
    <link rel="stylesheet" href="./css/style.css">
  <title>투자 관상 테스트</title>
</head>

<body>
  <nav class="navbar navbar-expand-lg navbar-light">
    <div class="container">
      <a class="navbar-brand" href="#" style="font-family: Independence_hall;">투자 관상 테스트</a>
    </div>
  </nav>
  
  <div class="container" id="app">
    <!-- Content here -->
    <div class="row justify-content-center mt-2 mb-3 ai-header">인공지능이 알려주는 나의 투자 관상!</div>

    <div>
      <div class="file-upload col-12 col-md-8 col-lg-6 bg-light border">
        <div class="image-upload-wrap mt-3 mb-3">
          <input class="file-upload-input" type='file' onchange="readURL(this);" accept="image/*" />
          <div class="drag-text">
            <h3 style="font-family: Binggrae-B;">사진 첨부</h3>
          </div>
        </div>
        <div class="file-upload-content" style="height: 90%;">
          <img class="file-upload-image" id="face-image" src="#" alt="your image" style="height: 100%;"/>
        </div>
      </div>

    </div>

    <div class="row justify-content-center col-12 col-md-10 col-lg-8 mt-3 mb-3" style="margin: 0 auto;">
      <h3 class="row justify-content-center recommand-item-header" id="recommandTitle">
      </h3>
      <p class="row justify-content-center mt-2 recommand-item-sub" id="recommandReason"></p>
      
        
      <div class="ai-probar-list mt-2" id="label-container">
      </div>
      
    </div>

    <div id="reRegister" class="row justify-content-center mt-2 mb-2" style="display: none;font-family: 'Binggrae-R';">
      <div class="col-auto">
        <el-button onclick="$('.file-upload-input').trigger('click')">다시 등록하기</el-button>
      </div>
    </div>

  </div>

  <!-- Optional JavaScript -->
  <!-- jQuery first, then Popper.js, then Bootstrap JS -->
  <script src="https://code.jquery.com/jquery-3.3.1.slim.min.js" integrity="sha384-q8i/X+965DzO0rT7abK41JStQIAqVgRVzpbzo5smXKp4YfRvH+8abtTE1Pi6jizo" crossorigin="anonymous"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.14.3/umd/popper.min.js" integrity="sha384-ZMP7rVo3mIykV+2+9J3UJ46jBk0WLaUAdn689aCwoqbBJiSnjAK/l8WvCWPIPm49" crossorigin="anonymous"></script>
  <script src="https://stackpath.bootstrapcdn.com/bootstrap/4.1.3/js/bootstrap.min.js" integrity="sha384-ChfqqxuZUCnJSK3+MXmPNIyE6ZbWh2IMqE241rYiqJxyMiZ6OW/JmZQ5stwEULTy" crossorigin="anonymous"></script>
  <script src="https://cdn.jsdelivr.net/npm/@tensorflow/tfjs@1.3.1/dist/tf.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/@teachablemachine/image@0.8/dist/teachablemachine-image.min.js"></script>
  <script src="./js/common.js"></script>
  <script src="./js/get-result.js"></script>
  <script type="text/javascript">
    
  </script>

  <script>
    
   
  </script>

  <!-- import Vue before Element -->
  <script src="https://unpkg.com/vue/dist/vue.js"></script>
  <!-- import JavaScript -->
  <script src="https://unpkg.com/element-ui/lib/index.js"></script>
  <script>
    let loading;
    let app = new Vue({
      el: '#app',
      data: function() {
        return {
          visible: false,
          fullscreenLoading: false
        }
      },
      methods: {
        openLoadingBar() {
          loading = this.$loading({
            lock: true,
            text: 'AI가 당신의 이미지를 분석중입니다...',
            spinner: 'el-icon-loading',
            background: 'rgba(0, 0, 0, 0.7)'
          });
        },
        closeLoadingBar() {
          loading.close();
        }

      }
    });

    function readURL(input) {
      if (input.files && input.files[0]) {

        var reader = new FileReader();

        reader.onload = function (e) {
          $('.image-upload-wrap').hide();

          $('.file-upload-image').attr('src', e.target.result);
          $('.file-upload-content').show();

          $('.image-title').html(input.files[0].name);
        };
        reader.readAsDataURL(input.files[0]);
        app.openLoadingBar();
        init().then(() => {
          predict();
          $('#reRegister').show();
        });

      } else {
        // removeUpload();
      }
    }


    function removeUpload() {
      $('.file-upload-input').replaceWith($('.file-upload-input').clone());
      $('.file-upload-content').hide();
      $('.image-upload-wrap').show();
    }
    $('.image-upload-wrap').bind('dragover', function () {
      $('.image-upload-wrap').addClass('image-dropping');
    });
    $('.image-upload-wrap').bind('dragleave', function () {
      $('.image-upload-wrap').removeClass('image-dropping');
    });

    const URL = "./my_model/invest/";

    let model, webcam, labelContainer, maxPredictions;

    // Load the image model and setup the webcam
    async function init() {
      const modelURL = URL + "model.json";
      const metadataURL = URL + "metadata.json";

      // load the model and metadata
      // Refer to tmImage.loadFromFiles() in the API to support files from a file picker
      // or files from your local hard drive
      // Note: the pose library adds "tmImage" object to your window (window.tmImage)
      model = await tmImage.load(modelURL, metadataURL);
      maxPredictions = model.getTotalClasses();

      labelContainer = document.getElementById("label-container");
      for (let i = 0; i < maxPredictions; i++) { // and class labels
       console.log('test');
       labelContainer.appendChild(document.createElement("div"));
      }
    }

    // run the webcam image through the image model
    async function predict() {
      // predict can take in an image, video or canvas html element
      var image = document.getElementById("face-image")
      const prediction = await model.predict(image, false);
      prediction.sort((a, b) => parseFloat(b.probability) - parseFloat(a.probability));
      // resultImageAnswer(prediction[0].className);
      
      $('#label-container').html();
      for (let i = 0; i < 5; i++) {
        let predictPercent = parseInt((prediction[i].probability.toFixed(2) * 100));
        if (i == 0) {
          $('#recommandTitle').html('AI 추천 종목 : ' + prediction[i].className);
          $('#recommandReason').html(getCommandReason(prediction[i].className));
        }
        let row = '';
        row += '<div class="ai-probar-box">';
        row += '<div class="ai-probar-title">' + prediction[i].className + '</div>';
        row += '<div class="progress probar-box-' + i + '">';
        row += '<div class="progress-bar probar-value-' + i + '" role="progressbar" style="width: ' + predictPercent +'%;">';
        row += '</div>';
        row += '<div class="probar-value-text">' + predictPercent + '%</div>';
        row += '</div>';
        console.log(row);
        labelContainer.childNodes[i].innerHTML = row;
      }
      app.closeLoadingBar();
    }
  
  </script>

</body>

</html>