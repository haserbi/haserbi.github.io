<!doctype html><html lang=ko dir=auto><head><meta charset=utf-8><meta http-equiv=x-ua-compatible content="IE=edge"><meta name=viewport content="width=device-width,initial-scale=1,shrink-to-fit=no"><meta name=robots content="index, follow"><title>Nodejs 프로젝트 적응기 | Halog</title><meta name=keywords content=","><meta name=description content="6개월 프로젝트로 Node.js를 처음 하면서 만났던 여러 문제들을 처리한 내용을 공유합니다.
약 4개월 정도는 backend 개발을 했던 것 같고, 이후 다른 시스템과 함께 맞춰서 프로젝트를 마무리 했던 것 같습니다.
backend에서는 기본적인 CRUD 기능과 유효성 처리, jwt 인증, 파일 업로드(이어올리기, siging작업 등), FOTA 캠페인 진행 등이 주요 내용입니다.
프로젝트 기술 선택 Framework: express DB: MySQL 먼저 Node.js에서 유명한 프레임워크로 express와 nest.js가 있습니다.
먼저 Spring Backend에 대한 경험으로 nest.js에 대해 고민했지만, npm trends 비교 및 express가 개발 속도 및 현재까지 사용한 사용자도 많기에 express로 선택했습니다."><meta name=author content><link rel=canonical href=https://haservi.github.io/posts/nodejs/start-nodejs/><meta name=google-site-verification content="G-MXZP81P04W"><link rel=stylesheet as=style crossorigin href=https://cdn.jsdelivr.net/gh/orioncactus/pretendard@v1.3.6/dist/web/static/pretendard.css><link crossorigin=anonymous href=/assets/css/stylesheet.css rel="preload stylesheet" as=style><script defer crossorigin=anonymous src=/assets/js/highlight.js onload=hljs.initHighlightingOnLoad()></script>
<link rel=icon href=https://haservi.github.io/favicon.ico><link rel=icon type=image/png sizes=16x16 href=https://haservi.github.io/favicon-16x16.png><link rel=icon type=image/png sizes=32x32 href=https://haservi.github.io/favicon-32x32.png><link rel=apple-touch-icon href=https://haservi.github.io/apple-touch-icon.png><link rel=mask-icon href=https://haservi.github.io/safari-pinned-tab.svg><meta name=theme-color content="#2e2e33"><meta name=msapplication-TileColor content="#2e2e33"><noscript><style>#theme-toggle,.top-link{display:none}</style></noscript><script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-1400973749140762" crossorigin=anonymous></script>
<script async src="https://www.googletagmanager.com/gtag/js?id=G-RP5NDCM8J9"></script>
<script>var doNotTrack=!1;if(!doNotTrack){window.dataLayer=window.dataLayer||[];function gtag(){dataLayer.push(arguments)}gtag("js",new Date),gtag("config","G-RP5NDCM8J9",{anonymize_ip:!1})}</script><meta property="og:title" content="Nodejs 프로젝트 적응기"><meta property="og:description" content="6개월 프로젝트로 Node.js를 처음 하면서 만났던 여러 문제들을 처리한 내용을 공유합니다.
약 4개월 정도는 backend 개발을 했던 것 같고, 이후 다른 시스템과 함께 맞춰서 프로젝트를 마무리 했던 것 같습니다.
backend에서는 기본적인 CRUD 기능과 유효성 처리, jwt 인증, 파일 업로드(이어올리기, siging작업 등), FOTA 캠페인 진행 등이 주요 내용입니다.
프로젝트 기술 선택 Framework: express DB: MySQL 먼저 Node.js에서 유명한 프레임워크로 express와 nest.js가 있습니다.
먼저 Spring Backend에 대한 경험으로 nest.js에 대해 고민했지만, npm trends 비교 및 express가 개발 속도 및 현재까지 사용한 사용자도 많기에 express로 선택했습니다."><meta property="og:type" content="article"><meta property="og:url" content="https://haservi.github.io/posts/nodejs/start-nodejs/"><meta property="og:image" content="https://haservi.github.io/cover.jpeg"><meta property="article:section" content="posts"><meta property="article:published_time" content="2023-06-28T20:47:06+09:00"><meta property="article:modified_time" content="2023-06-28T20:47:06+09:00"><meta property="og:site_name" content="Halog"><meta name=twitter:card content="summary_large_image"><meta name=twitter:image content="https://haservi.github.io/cover.jpeg"><meta name=twitter:title content="Nodejs 프로젝트 적응기"><meta name=twitter:description content="6개월 프로젝트로 Node.js를 처음 하면서 만났던 여러 문제들을 처리한 내용을 공유합니다.
약 4개월 정도는 backend 개발을 했던 것 같고, 이후 다른 시스템과 함께 맞춰서 프로젝트를 마무리 했던 것 같습니다.
backend에서는 기본적인 CRUD 기능과 유효성 처리, jwt 인증, 파일 업로드(이어올리기, siging작업 등), FOTA 캠페인 진행 등이 주요 내용입니다.
프로젝트 기술 선택 Framework: express DB: MySQL 먼저 Node.js에서 유명한 프레임워크로 express와 nest.js가 있습니다.
먼저 Spring Backend에 대한 경험으로 nest.js에 대해 고민했지만, npm trends 비교 및 express가 개발 속도 및 현재까지 사용한 사용자도 많기에 express로 선택했습니다."><script type=application/ld+json>{"@context":"https://schema.org","@type":"BreadcrumbList","itemListElement":[{"@type":"ListItem","position":1,"name":"Posts","item":"https://haservi.github.io/posts/"},{"@type":"ListItem","position":2,"name":"Nodejs 프로젝트 적응기","item":"https://haservi.github.io/posts/nodejs/start-nodejs/"}]}</script><script type=application/ld+json>{"@context":"https://schema.org","@type":"BlogPosting","headline":"Nodejs 프로젝트 적응기","name":"Nodejs 프로젝트 적응기","description":"6개월 프로젝트로 Node.js를 처음 하면서 만났던 여러 문제들을 처리한 내용을 공유합니다.\n약 4개월 정도는 backend 개발을 했던 것 같고, 이후 다른 시스템과 함께 맞춰서 프로젝트를 마무리 했던 것 같습니다.\nbackend에서는 기본적인 CRUD 기능과 유효성 처리, jwt 인증, 파일 업로드(이어올리기, siging작업 등), FOTA 캠페인 진행 등이 주요 내용입니다.\n프로젝트 기술 선택 Framework: express DB: MySQL 먼저 Node.js에서 유명한 프레임워크로 express와 nest.js가 있습니다.\n먼저 Spring Backend에 대한 경험으로 nest.js에 대해 고민했지만, npm trends 비교 및 express가 개발 속도 및 현재까지 사용한 사용자도 많기에 express로 선택했습니다.","keywords":["",""],"articleBody":"6개월 프로젝트로 Node.js를 처음 하면서 만났던 여러 문제들을 처리한 내용을 공유합니다.\n약 4개월 정도는 backend 개발을 했던 것 같고, 이후 다른 시스템과 함께 맞춰서 프로젝트를 마무리 했던 것 같습니다.\nbackend에서는 기본적인 CRUD 기능과 유효성 처리, jwt 인증, 파일 업로드(이어올리기, siging작업 등), FOTA 캠페인 진행 등이 주요 내용입니다.\n프로젝트 기술 선택 Framework: express DB: MySQL 먼저 Node.js에서 유명한 프레임워크로 express와 nest.js가 있습니다.\n먼저 Spring Backend에 대한 경험으로 nest.js에 대해 고민했지만, npm trends 비교 및 express가 개발 속도 및 현재까지 사용한 사용자도 많기에 express로 선택했습니다.\nORM은 어느 정도의 진입장벽이 있다고 판단하여 typeorm의 기본적인 쿼리로 정도만 넣었으며, native query를 이용하여 동작하도록 설정 후 이후 리팩토링을 했습니다.\n개발 돌이켜보면 처음 한달에 삽질을 많이하고 그 뒤로는 어느 정도 프로젝트의 구조가 잡히니 기능 구현에 큰 어려움은 없었습니다.\n이후 다른 시스템 지원이 어려웠던 것 같았습니다. c, c++ 프로젝트 ㅠ..\n1월 1주차\nexpress 프로젝트 생성을 합니다. 음?? 그런데 기존에 찾아봤던 Node.js의 구조와 다르더군요. 무슨 bin폴더에서 www파일을 이용해서 빌드가 되는데 좀 마음에 안든다. VS Code에서 디버깅은 어떻게 해야하지?\n1월 2주차\njavascript는 대충 알겠다. 타입이 없어서 좀 마음에 안들지만 디버깅 주도 개발 하면 금방 개발이 되니 좋은것도 같다. Type ORM과 MySQL을 함께 쓸 때 native 쿼리를 쓸 경우는 어떻게 설정하고 release()는 꼭 해줘야 하네. 기본적인 CRUD는 어느 정도 처리할 수 있겠다.\n1월 3주차\nJavascript에서 Typescript로 코드를 변경했다. tsconfig를 통해 Typescript를 쓸 수 있나 보다. enum을 지양하네? 이유가 뭘까? 관련 링크 이 시기부터 이펙티브 타입스크립트 책을 함께 읽었습니다. any 타입에 대한 이해 및 MVC 스타일로 작성할 때 DTO와 Entity에 대한 처리 방법(class-transformer) 반복적인 API 생성 및 유효성 처리 작업 PM2 및 DB 커넥션 이슈 등을 만나게 됨 대용량 파일 처리 시 동작 방식에 대한 이해(비동기로 많이 쪼개서 작업하는게 빠르다?) busboy 라이브러리의 close와 finish를 같이 쓰면 linux에서 빌드 시 오류가 발생할 수 있다. req.end 관련 문제 같음 프로젝트 진행하면 만난 문제점들 express와 nest.js 중 어떤게 프로젝트에 좋을지\n기간이 짧은 경우 express를 사용하는게 좋지만, 유지보수 측면에서는 nest.js가 더 좋을 것도 같다. 해당 프레임워크 선택은 프로젝트 규모와 기능에 대한 검토가 필요함(빠르게 개발은 express가 좋다고 느낌) 프로젝트 구조는 어떻게 설계하는게 좋을지\n초반에 express-generator를 이용하여 프로젝트 생성(www폴더가 처음엔 뭔지 몰랐는데 이후엔 좀 거부감..) 자바스크립트를 이용해 기능별로 패키지 분리 이후 타입스크립트로 변경하여 전체 구조 변경(기본적인 nodejs backend 처럼 변경) router와 비슷한 개념을 controller로 파일명 변경(controller에서는 request 유효성 처리 및 response 템플릿 처리) service에서 여러 repository와 연동 및 비즈니스로직 데이터 가공(서비스 로직에 비즈니스로직이 들어가면 테스트코드 작성이 어렵다.) repository에서 orm 쿼리 또는 native쿼리로 service처리 DB연동 및 typeorm 적용 여부\nexpress는 mongusdb와 궁합이 좋다고 하지만 현재 프로젝트 기간 및 no-sql보다는 mysql를 선택 typeorm entity와 관련하여 synchronize 기능 제공(스프링은 ddl-auto 같다) 스프링 처럼 repository 로 orm 스럽게도 구현이 가능하지만 일정 및 n+1 및 fetch? 이슈 등이 있을 거라 생각하여 일단 간단한 쿼리는 orm 복잡한 쿼리는 native로 처리 후 orm 스럽게 리팩토링 진행 예정 타입스크립트에서 오버로딩은 안되는건가?\n타입스크립트에서는 타입과 런타임의 동작이 무관하기 때문에, 함수 오버로딩은 불가 swagger 문서화 처리\nexpress로 사용하는 경우 swagger에 관련된 코드를 그냥 다른 파일로 빼는게 가독성 측면에서 좋아보임 초반에 거부감이 많이 많이 들었지만, 좀 하다 보면 그래도 할만한 느낌 nest.js를 쓰면 코드 어노테이션으로 처리 가능 코드 실행 중 잘못된 호출 또는 로직 수행중에 exception 발생하면 서버가 죽음\n추후 PM2로 여러 스레드 작업 및 docker로 분리함 typeorm 사용 방법 및 nativequery와 함께 사용하는 방법\n타입스크립트 적용 방법\nC++ 소스코드를 typescript에 선언하고 사용하는 방법\nnode-addon 대용량 파일을 업로드하고 다운로드 하는 방법 및 문제점\n파일 업로드 시 busboy를 이용해 chunk값으로 이어올리기 기능 구현 request에 대한 유효성 체크 방법\nnpm 중 class-validation과 express-validation이 있다. class-valdaion의 경우 request dto에 어노테이션 을 선언해서 사용하고, express-validation은 라우터에서 처리한다. npm trends를 보면 class-validation을 더 많이 사용함 response 응답값에 대한 template 생성 및 유효성 처리를 공통적으로 하는 방법\n유효성이 실패한 경우 다양한 형태가 존재하며, 이것에 대한 함수를 나눠 처리함 async await의 올바른 사용법과 트랜잭션 처리\n쿼리 또는 함수의 응답값이 필요한 경우 await를 이용해 처리함 미들웨어와 유틸함수의 차이점\n추후 배포할 때 어떻게 하는게 좋을지 고민 필요\n대용량 파일 업로드(10GB 이상) 시 해당 파일 암호화 hash 방법 고민 필요\nfs.createReadStream을 이용하여 처리\ncreateFileSync의 경우 아래와 같은 에러 발생\n1 2 3 4 5 error: [package/file-upload: File size (12884910080) is greater than 2 GB {\"code\":\"ERR_FS_FILE_TOO_LARGE\",\"stack\":\"RangeError [ERR_FS_FILE_TOO_LARGE]: File size (12884910080) is greater than 2 GB\\n at new NodeError (node:internal/errors:372:5)\\n at tryCreateBuffer (node:fs:420:13)\\n at Object.readFileSync (node:fs:465:14)\\n at PackageService... 파일 업로드 이후 메타데이터를 추가해야하는데 어떻게 해야 할지 고민 필요\n요청에 따라 KISA SHA 256을 적용(Javascript 예제가 없어서 Java 또는 C++을 이용예정), 다른 암호화 라이브러리로 해도 될 것 같은데 확인 필요 cryto를 이용해서 hash처리(signing과 관련된 내용 확인 필요) createReadStream이 비동기이기 때문에 이를 위해 new Promise로 적용 파일 업로드와 동시에 hash 처리 하는 방법도 고민 필요(이러면 중간에 끊기면 hash를 어떻게 처리할지 고민 필요) Typescript에서 문자열 바이트코드 변환 확인\nTextEncoder() 함수 사용 any 타입에 대해서\nany 타입을 사용하면 타입 체커와 타입스크립트 언어 서비스를 무력화시킨다. any 타입은 진짜 문제점을 감추며, 개발 경험을 나쁘게 하며, 코드의 신뢰도를 떨어뜨린다. Worker Thread\n기존 프로젝트에서 C++ 로 처리해야 하는 로직이 있어 addon된 함수를 worker thread 방식으로 적용 Node는 요청을 받으면 현재 요청에 대한 다른 요청을 받을 수 없다. 이러한 처리를 효율적으로 하기 위해 Node는 이벤트 루프와 콜백 함수를 통해 비동기로 동작한다. console.log는 메인쓰레드에서 동작하므로 얘로 테스트 하면 안됨 파일 대용량 db업로드시\nbody Parser = 기본 허용치 100kb 이거를 늘려주면 된다.\n1 2 app.use(express.json({ limit: '50mb' })); app.use(express.urlencoded({ limit: '50mb', extended: true })); 쿼리 동작중에 Cannot enqueue Query after fatal error.이런 에러가 발생\ndb의 시간 만료를 늘려주면 해결된다는 경우도 있습니다.링크 위와 같이 늘려줬었는데 종종 발생하여 반대로 시간 만료를 극단적으로 줄여서 에러를 확인할 수 있었습니다. 문제는 typeorm과 nativequery를 쓰기위해 repository 파일을 참조하는게 문제의 원인이었습니다. 조금 더 고민해야 할 것 대용량 파일 다운로드 시 효율적인 방법 header의 값에 Range를 할당하여 클라이언트에서 여러 호출을 하도록 지정할 수 있음참고 ","wordCount":"903","inLanguage":"ko","datePublished":"2023-06-28T20:47:06+09:00","dateModified":"2023-06-28T20:47:06+09:00","mainEntityOfPage":{"@type":"WebPage","@id":"https://haservi.github.io/posts/nodejs/start-nodejs/"},"publisher":{"@type":"Organization","name":"Halog","logo":{"@type":"ImageObject","url":"https://haservi.github.io/favicon.ico"}}}</script></head><body class=dark id=top><script>localStorage.getItem("pref-theme")==="light"&&document.body.classList.remove("dark")</script><header class=header><nav class=nav><div class=logo><a href=https://haservi.github.io/ accesskey=h title="Halog (Alt + H)">Halog</a><div class=logo-switches><button id=theme-toggle accesskey=t title="(Alt + T)"><svg id="moon" xmlns="http://www.w3.org/2000/svg" width="24" height="18" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M21 12.79A9 9 0 1111.21 3 7 7 0 0021 12.79z"/></svg><svg id="sun" xmlns="http://www.w3.org/2000/svg" width="24" height="18" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="5"/><line x1="12" y1="1" x2="12" y2="3"/><line x1="12" y1="21" x2="12" y2="23"/><line x1="4.22" y1="4.22" x2="5.64" y2="5.64"/><line x1="18.36" y1="18.36" x2="19.78" y2="19.78"/><line x1="1" y1="12" x2="3" y2="12"/><line x1="21" y1="12" x2="23" y2="12"/><line x1="4.22" y1="19.78" x2="5.64" y2="18.36"/><line x1="18.36" y1="5.64" x2="19.78" y2="4.22"/></svg></button></div></div><ul id=menu><li><a href=https://haservi.github.io/archives/ title=Archive><span>Archive</span></a></li><li><a href=https://haservi.github.io/categories/ title=Categories><span>Categories</span></a></li><li><a href=https://haservi.github.io/search/ title="Search (Alt + /)" accesskey=/><span>Search</span></a></li></ul></nav></header><main class=main><article class=post-single><header class=post-header><div class=breadcrumbs><a href=https://haservi.github.io/>홈</a>&nbsp;»&nbsp;<a href=https://haservi.github.io/posts/>Posts</a></div><h1 class=post-title>Nodejs 프로젝트 적응기</h1><div class=post-meta><span title='2023-06-28 20:47:06 +0900 +0900'>6월 28, 2023</span>&nbsp;·&nbsp;5 분</div></header><div class=post-content><p>6개월 프로젝트로 Node.js를 처음 하면서 만났던 여러 문제들을 처리한 내용을 공유합니다.</p><p>약 4개월 정도는 backend 개발을 했던 것 같고, 이후 다른 시스템과 함께 맞춰서 프로젝트를 마무리 했던 것 같습니다.</p><p>backend에서는 기본적인 CRUD 기능과 유효성 처리, jwt 인증, 파일 업로드(이어올리기, siging작업 등), FOTA 캠페인 진행 등이 주요 내용입니다.</p><h2 id=프로젝트-기술-선택>프로젝트 기술 선택<a hidden class=anchor aria-hidden=true href=#프로젝트-기술-선택>#</a></h2><ul><li>Framework: express</li><li>DB: MySQL</li></ul><p>먼저 Node.js에서 유명한 프레임워크로 express와 nest.js가 있습니다.</p><p>먼저 Spring Backend에 대한 경험으로 nest.js에 대해 고민했지만, <a href=https://npmtrends.com/ target=_blank>npm trends</a>
비교 및
express가 개발 속도 및 현재까지 사용한 사용자도 많기에 express로 선택했습니다.</p><p><img loading=lazy src=./images/image01.png#center alt=images></p><p>ORM은 어느 정도의 진입장벽이 있다고 판단하여 typeorm의 기본적인 쿼리로 정도만 넣었으며, native query를 이용하여 동작하도록
설정 후 이후 리팩토링을 했습니다.</p><h3 id=개발>개발<a hidden class=anchor aria-hidden=true href=#개발>#</a></h3><p>돌이켜보면 처음 한달에 삽질을 많이하고 그 뒤로는 어느 정도 프로젝트의 구조가 잡히니 기능 구현에 큰 어려움은 없었습니다.<br>이후 다른 시스템 지원이 어려웠던 것 같았습니다. c, c++ 프로젝트 ㅠ..</p><p>1월 1주차</p><p>express 프로젝트 생성을 합니다. 음?? 그런데 기존에 찾아봤던 Node.js의 구조와 다르더군요. 무슨 <code>bin</code>폴더에서 www파일을
이용해서 빌드가 되는데 좀 마음에 안든다. VS Code에서 디버깅은 어떻게 해야하지?</p><p>1월 2주차</p><p>javascript는 대충 알겠다. 타입이 없어서 좀 마음에 안들지만 디버깅 주도 개발 하면 금방 개발이 되니 좋은것도 같다. Type ORM과
MySQL을 함께 쓸 때 native 쿼리를 쓸 경우는 어떻게 설정하고 release()는 꼭 해줘야 하네. 기본적인 CRUD는 어느 정도 처리할 수 있겠다.</p><p>1월 3주차</p><ul><li>Javascript에서 Typescript로 코드를 변경했다.</li><li>tsconfig를 통해 Typescript를 쓸 수 있나 보다.</li><li>enum을 지양하네? 이유가 뭘까? <a href=https://engineering.linecorp.com/ko/blog/typescript-enum-tree-shaking/ target=_blank>관련 링크</a></li><li>이 시기부터 이펙티브 타입스크립트 책을 함께 읽었습니다.</li><li>any 타입에 대한 이해 및 MVC 스타일로 작성할 때 DTO와 Entity에 대한 처리 방법(class-transformer)</li><li>반복적인 API 생성 및 유효성 처리 작업</li><li>PM2 및 DB 커넥션 이슈 등을 만나게 됨</li><li>대용량 파일 처리 시 동작 방식에 대한 이해(비동기로 많이 쪼개서 작업하는게 빠르다?)</li><li><code>busboy</code> 라이브러리의 close와 finish를 같이 쓰면 linux에서 빌드 시 오류가 발생할 수 있다.<ul><li>req.end 관련 문제 같음</li></ul></li></ul><h3 id=프로젝트-진행하면-만난-문제점들>프로젝트 진행하면 만난 문제점들<a hidden class=anchor aria-hidden=true href=#프로젝트-진행하면-만난-문제점들>#</a></h3><ul><li><p>express와 nest.js 중 어떤게 프로젝트에 좋을지</p><ul><li>기간이 짧은 경우 express를 사용하는게 좋지만, 유지보수 측면에서는 nest.js가 더 좋을 것도 같다.
해당 프레임워크 선택은 프로젝트 규모와 기능에 대한 검토가 필요함(빠르게 개발은 express가 좋다고 느낌)</li></ul></li><li><p>프로젝트 구조는 어떻게 설계하는게 좋을지</p><ul><li>초반에 express-generator를 이용하여 프로젝트 생성(www폴더가 처음엔 뭔지 몰랐는데 이후엔 좀 거부감..)</li><li>자바스크립트를 이용해 기능별로 패키지 분리</li><li>이후 타입스크립트로 변경하여 전체 구조 변경(기본적인 nodejs backend 처럼 변경)</li><li>router와 비슷한 개념을 controller로 파일명 변경(controller에서는 request 유효성 처리 및 response 템플릿 처리)</li><li>service에서 여러 repository와 연동 및 비즈니스로직 데이터 가공(서비스 로직에 비즈니스로직이 들어가면 테스트코드 작성이 어렵다.)</li><li>repository에서 orm 쿼리 또는 native쿼리로 service처리</li></ul></li><li><p>DB연동 및 typeorm 적용 여부</p><ul><li>express는 mongusdb와 궁합이 좋다고 하지만 현재 프로젝트 기간 및 no-sql보다는 mysql를 선택</li><li>typeorm entity와 관련하여 synchronize 기능 제공(스프링은 ddl-auto 같다)</li><li>스프링 처럼 repository 로 orm 스럽게도 구현이 가능하지만 일정 및 n+1 및 fetch? 이슈 등이 있을 거라 생각하여
일단 간단한 쿼리는 orm 복잡한 쿼리는 native로 처리 후 orm 스럽게 리팩토링 진행 예정</li></ul></li><li><p>타입스크립트에서 오버로딩은 안되는건가?</p><ul><li>타입스크립트에서는 타입과 런타임의 동작이 무관하기 때문에, 함수 오버로딩은 불가</li></ul></li><li><p>swagger 문서화 처리</p><ul><li>express로 사용하는 경우 swagger에 관련된 코드를 그냥 다른 파일로 빼는게 가독성 측면에서 좋아보임</li><li>초반에 거부감이 많이 많이 들었지만, 좀 하다 보면 그래도 할만한 느낌 nest.js를 쓰면 코드 어노테이션으로 처리 가능</li></ul></li><li><p>코드 실행 중 잘못된 호출 또는 로직 수행중에 exception 발생하면 서버가 죽음</p><ul><li>추후 PM2로 여러 스레드 작업 및 docker로 분리함</li></ul></li><li><p>typeorm 사용 방법 및 nativequery와 함께 사용하는 방법</p></li><li><p>타입스크립트 적용 방법</p></li><li><p>C++ 소스코드를 typescript에 선언하고 사용하는 방법</p><ul><li>node-addon</li></ul></li><li><p>대용량 파일을 업로드하고 다운로드 하는 방법 및 문제점</p><ul><li>파일 업로드 시 busboy를 이용해 chunk값으로 이어올리기 기능 구현</li></ul></li><li><p>request에 대한 유효성 체크 방법</p><ul><li>npm 중 class-validation과 express-validation이 있다. class-valdaion의 경우 request dto에 어노테이션
을 선언해서 사용하고, express-validation은 라우터에서 처리한다. npm trends를 보면 class-validation을 더 많이 사용함</li></ul></li><li><p>response 응답값에 대한 template 생성 및 유효성 처리를 공통적으로 하는 방법</p><ul><li>유효성이 실패한 경우 다양한 형태가 존재하며, 이것에 대한 함수를 나눠 처리함</li></ul></li><li><p>async await의 올바른 사용법과 트랜잭션 처리</p><ul><li>쿼리 또는 함수의 응답값이 필요한 경우 await를 이용해 처리함</li></ul></li><li><p>미들웨어와 유틸함수의 차이점</p></li><li><p>추후 배포할 때 어떻게 하는게 좋을지 고민 필요</p></li><li><p>대용량 파일 업로드(10GB 이상) 시 해당 파일 암호화 hash 방법 고민 필요</p><ul><li><p>fs.createReadStream을 이용하여 처리</p></li><li><p>createFileSync의 경우 아래와 같은 에러 발생</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>error: <span class=o>[</span>package/file-upload: File size <span class=o>(</span>12884910080<span class=o>)</span> is greater than <span class=m>2</span> GB   
</span></span><span class=line><span class=cl><span class=o>{</span><span class=s2>&#34;code&#34;</span>:<span class=s2>&#34;ERR_FS_FILE_TOO_LARGE&#34;</span>,<span class=s2>&#34;stack&#34;</span>:<span class=s2>&#34;RangeError [ERR_FS_FILE_TOO_LARGE]:  
</span></span></span><span class=line><span class=cl><span class=s2>File size (12884910080) is  greater than 2 GB\n  at new NodeError (node:internal/errors:372:5)\n  
</span></span></span><span class=line><span class=cl><span class=s2>at tryCreateBuffer (node:fs:420:13)\n    at Object.readFileSync (node:fs:465:14)\n  
</span></span></span><span class=line><span class=cl><span class=s2>at PackageService...
</span></span></span></code></pre></td></tr></table></div></div></li></ul></li><li><p>파일 업로드 이후 메타데이터를 추가해야하는데 어떻게 해야 할지 고민 필요</p><ul><li>요청에 따라 KISA SHA 256을 적용(Javascript 예제가 없어서 Java 또는 C++을 이용예정), 다른 암호화 라이브러리로 해도 될 것 같은데 확인 필요</li><li>cryto를 이용해서 hash처리(signing과 관련된 내용 확인 필요)</li><li>createReadStream이 비동기이기 때문에 이를 위해 new Promise로 적용</li><li>파일 업로드와 동시에 hash 처리 하는 방법도 고민 필요(이러면 중간에 끊기면 hash를 어떻게 처리할지 고민 필요)</li></ul></li><li><p>Typescript에서 문자열 바이트코드 변환 확인</p><ul><li>TextEncoder() 함수 사용</li></ul></li><li><p>any 타입에 대해서</p><ul><li>any 타입을 사용하면 타입 체커와 타입스크립트 언어 서비스를 무력화시킨다. any 타입은 진짜 문제점을 감추며, 개발 경험을 나쁘게 하며, 코드의 신뢰도를
떨어뜨린다.</li></ul></li><li><p>Worker Thread</p><ul><li>기존 프로젝트에서 C++ 로 처리해야 하는 로직이 있어 addon된 함수를 worker thread 방식으로 적용</li><li>Node는 요청을 받으면 현재 요청에 대한 다른 요청을 받을 수 없다. 이러한 처리를 효율적으로 하기 위해 Node는 이벤트 루프와 콜백 함수를 통해
비동기로 동작한다.</li><li>console.log는 메인쓰레드에서 동작하므로 얘로 테스트 하면 안됨</li></ul></li><li><p>파일 대용량 db업로드시</p><ul><li><p>body Parser = 기본 허용치 100kb 이거를 늘려주면 된다.</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-typescript data-lang=typescript><span class=line><span class=cl><span class=nx>app</span><span class=p>.</span><span class=nx>use</span><span class=p>(</span><span class=nx>express</span><span class=p>.</span><span class=nx>json</span><span class=p>({</span> <span class=nx>limit</span><span class=o>:</span> <span class=s1>&#39;50mb&#39;</span> <span class=p>}));</span>
</span></span><span class=line><span class=cl><span class=nx>app</span><span class=p>.</span><span class=nx>use</span><span class=p>(</span><span class=nx>express</span><span class=p>.</span><span class=nx>urlencoded</span><span class=p>({</span> <span class=nx>limit</span><span class=o>:</span> <span class=s1>&#39;50mb&#39;</span><span class=p>,</span> <span class=nx>extended</span>: <span class=kt>true</span> <span class=p>}));</span>
</span></span></code></pre></td></tr></table></div></div></li></ul></li><li><p>쿼리 동작중에 <code>Cannot enqueue Query after fatal error.</code>이런 에러가 발생</p><ul><li>db의 시간 만료를 늘려주면 해결된다는 경우도 있습니다.<a href=https://marumaru.tistory.com/16 target=_blank>링크</a></li><li>위와 같이 늘려줬었는데 종종 발생하여 반대로 시간 만료를 극단적으로 줄여서 에러를 확인할 수 있었습니다.</li><li>문제는 typeorm과 nativequery를 쓰기위해 repository 파일을 참조하는게 문제의 원인이었습니다.</li></ul></li></ul><h4 id=조금-더-고민해야-할-것>조금 더 고민해야 할 것<a hidden class=anchor aria-hidden=true href=#조금-더-고민해야-할-것>#</a></h4><ul><li>대용량 파일 다운로드 시 효율적인 방법<ul><li>header의 값에 Range를 할당하여 클라이언트에서 여러 호출을 하도록 지정할 수 있음<a href=https://developer.mozilla.org/ko/docs/Web/HTTP/Headers/Range target=_blank>참고</a></li></ul></li></ul></div><footer class=post-footer><ul class=post-tags></ul><nav class=paginav><a class=prev href=https://haservi.github.io/posts/review/udemy-k8s-docker/><span class=title>« 이전 페이지</span><br><span>[Udemy] Udemy K8s Docker 강의 후기</span></a>
<a class=next href=https://haservi.github.io/posts/tips/window-wsl-drive-change/><span class=title>다음 페이지 »</span><br><span>윈도우 WSL Ubuntu D Drive로 변경</span></a></nav><div class=share-buttons><a target=_blank rel="noopener noreferrer" aria-label="share Nodejs 프로젝트 적응기 on x" href="https://x.com/intent/tweet/?text=Nodejs%20%ed%94%84%eb%a1%9c%ec%a0%9d%ed%8a%b8%20%ec%a0%81%ec%9d%91%ea%b8%b0&url=https%3a%2f%2fhaservi.github.io%2fposts%2fnodejs%2fstart-nodejs%2f&hashtags=%2c"><svg viewBox="0 0 512 512" height="30" width="30" fill="currentcolor"><path d="M512 62.554V449.446C512 483.97 483.97 512 449.446 512H62.554C28.03 512 0 483.97.0 449.446V62.554C0 28.03 28.029.0 62.554.0H449.446C483.971.0 512 28.03 512 62.554zM269.951 190.75 182.567 75.216H56L207.216 272.95 63.9 436.783h61.366L235.9 310.383l96.667 126.4H456L298.367 228.367l134-153.151H371.033zM127.633 110h36.468l219.38 290.065H349.5z"/></svg></a><a target=_blank rel="noopener noreferrer" aria-label="share Nodejs 프로젝트 적응기 on linkedin" href="https://www.linkedin.com/shareArticle?mini=true&url=https%3a%2f%2fhaservi.github.io%2fposts%2fnodejs%2fstart-nodejs%2f&title=Nodejs%20%ed%94%84%eb%a1%9c%ec%a0%9d%ed%8a%b8%20%ec%a0%81%ec%9d%91%ea%b8%b0&summary=Nodejs%20%ed%94%84%eb%a1%9c%ec%a0%9d%ed%8a%b8%20%ec%a0%81%ec%9d%91%ea%b8%b0&source=https%3a%2f%2fhaservi.github.io%2fposts%2fnodejs%2fstart-nodejs%2f"><svg viewBox="0 0 512 512" height="30" width="30" fill="currentcolor"><path d="M449.446.0C483.971.0 512 28.03 512 62.554v386.892C512 483.97 483.97 512 449.446 512H62.554c-34.524.0-62.554-28.03-62.554-62.554V62.554c0-34.524 28.029-62.554 62.554-62.554h386.892zM160.461 423.278V197.561h-75.04v225.717h75.04zm270.539.0V293.839c0-69.333-37.018-101.586-86.381-101.586-39.804.0-57.634 21.891-67.617 37.266v-31.958h-75.021c.995 21.181.0 225.717.0 225.717h75.02V297.222c0-6.748.486-13.492 2.474-18.315 5.414-13.475 17.767-27.434 38.494-27.434 27.135.0 38.007 20.707 38.007 51.037v120.768H431zM123.448 88.722C97.774 88.722 81 105.601 81 127.724c0 21.658 16.264 39.002 41.455 39.002h.484c26.165.0 42.452-17.344 42.452-39.002-.485-22.092-16.241-38.954-41.943-39.002z"/></svg></a><a target=_blank rel="noopener noreferrer" aria-label="share Nodejs 프로젝트 적응기 on reddit" href="https://reddit.com/submit?url=https%3a%2f%2fhaservi.github.io%2fposts%2fnodejs%2fstart-nodejs%2f&title=Nodejs%20%ed%94%84%eb%a1%9c%ec%a0%9d%ed%8a%b8%20%ec%a0%81%ec%9d%91%ea%b8%b0"><svg viewBox="0 0 512 512" height="30" width="30" fill="currentcolor"><path d="M449.446.0C483.971.0 512 28.03 512 62.554v386.892C512 483.97 483.97 512 449.446 512H62.554c-34.524.0-62.554-28.03-62.554-62.554V62.554c0-34.524 28.029-62.554 62.554-62.554h386.892zM446 265.638c0-22.964-18.616-41.58-41.58-41.58-11.211.0-21.361 4.457-28.841 11.666-28.424-20.508-67.586-33.757-111.204-35.278l18.941-89.121 61.884 13.157c.756 15.734 13.642 28.29 29.56 28.29 16.407.0 29.706-13.299 29.706-29.701.0-16.403-13.299-29.702-29.706-29.702-11.666.0-21.657 6.792-26.515 16.578l-69.105-14.69c-1.922-.418-3.939-.042-5.585 1.036-1.658 1.073-2.811 2.761-3.224 4.686l-21.152 99.438c-44.258 1.228-84.046 14.494-112.837 35.232-7.468-7.164-17.589-11.591-28.757-11.591-22.965.0-41.585 18.616-41.585 41.58.0 16.896 10.095 31.41 24.568 37.918-.639 4.135-.99 8.328-.99 12.576.0 63.977 74.469 115.836 166.33 115.836s166.334-51.859 166.334-115.836c0-4.218-.347-8.387-.977-12.493 14.564-6.47 24.735-21.034 24.735-38.001zM326.526 373.831c-20.27 20.241-59.115 21.816-70.534 21.816-11.428.0-50.277-1.575-70.522-21.82-3.007-3.008-3.007-7.882.0-10.889 3.003-2.999 7.882-3.003 10.885.0 12.777 12.781 40.11 17.317 59.637 17.317 19.522.0 46.86-4.536 59.657-17.321 3.016-2.999 7.886-2.995 10.885.008 3.008 3.011 3.003 7.882-.008 10.889zm-5.23-48.781c-16.373.0-29.701-13.324-29.701-29.698.0-16.381 13.328-29.714 29.701-29.714 16.378.0 29.706 13.333 29.706 29.714.0 16.374-13.328 29.698-29.706 29.698zM160.91 295.348c0-16.381 13.328-29.71 29.714-29.71 16.369.0 29.689 13.329 29.689 29.71.0 16.373-13.32 29.693-29.689 29.693-16.386.0-29.714-13.32-29.714-29.693z"/></svg></a><a target=_blank rel="noopener noreferrer" aria-label="share Nodejs 프로젝트 적응기 on facebook" href="https://facebook.com/sharer/sharer.php?u=https%3a%2f%2fhaservi.github.io%2fposts%2fnodejs%2fstart-nodejs%2f"><svg viewBox="0 0 512 512" height="30" width="30" fill="currentcolor"><path d="M449.446.0C483.971.0 512 28.03 512 62.554v386.892C512 483.97 483.97 512 449.446 512H342.978V319.085h66.6l12.672-82.621h-79.272v-53.617c0-22.603 11.073-44.636 46.58-44.636H425.6v-70.34s-32.71-5.582-63.982-5.582c-65.288.0-107.96 39.569-107.96 111.204v62.971h-72.573v82.621h72.573V512h-191.104c-34.524.0-62.554-28.03-62.554-62.554V62.554c0-34.524 28.029-62.554 62.554-62.554h386.892z"/></svg></a><a target=_blank rel="noopener noreferrer" aria-label="share Nodejs 프로젝트 적응기 on whatsapp" href="https://api.whatsapp.com/send?text=Nodejs%20%ed%94%84%eb%a1%9c%ec%a0%9d%ed%8a%b8%20%ec%a0%81%ec%9d%91%ea%b8%b0%20-%20https%3a%2f%2fhaservi.github.io%2fposts%2fnodejs%2fstart-nodejs%2f"><svg viewBox="0 0 512 512" height="30" width="30" fill="currentcolor"><path d="M449.446.0C483.971.0 512 28.03 512 62.554v386.892C512 483.97 483.97 512 449.446 512H62.554c-34.524.0-62.554-28.03-62.554-62.554V62.554c0-34.524 28.029-62.554 62.554-62.554h386.892zm-58.673 127.703c-33.842-33.881-78.847-52.548-126.798-52.568-98.799.0-179.21 80.405-179.249 179.234-.013 31.593 8.241 62.428 23.927 89.612l-25.429 92.884 95.021-24.925c26.181 14.28 55.659 21.807 85.658 21.816h.074c98.789.0 179.206-80.413 179.247-179.243.018-47.895-18.61-92.93-52.451-126.81zM263.976 403.485h-.06c-26.734-.01-52.954-7.193-75.828-20.767l-5.441-3.229-56.386 14.792 15.05-54.977-3.542-5.637c-14.913-23.72-22.791-51.136-22.779-79.287.033-82.142 66.867-148.971 149.046-148.971 39.793.014 77.199 15.531 105.329 43.692 28.128 28.16 43.609 65.592 43.594 105.4-.034 82.149-66.866 148.983-148.983 148.984zm81.721-111.581c-4.479-2.242-26.499-13.075-30.604-14.571-4.105-1.495-7.091-2.241-10.077 2.241-2.986 4.483-11.569 14.572-14.182 17.562-2.612 2.988-5.225 3.364-9.703 1.12-4.479-2.241-18.91-6.97-36.017-22.23C231.8 264.15 222.81 249.484 220.198 245s-.279-6.908 1.963-9.14c2.016-2.007 4.48-5.232 6.719-7.847 2.24-2.615 2.986-4.484 4.479-7.472 1.493-2.99.747-5.604-.374-7.846-1.119-2.241-10.077-24.288-13.809-33.256-3.635-8.733-7.327-7.55-10.077-7.688-2.609-.13-5.598-.158-8.583-.158-2.986.0-7.839 1.121-11.944 5.604-4.105 4.484-15.675 15.32-15.675 37.364.0 22.046 16.048 43.342 18.287 46.332 2.24 2.99 31.582 48.227 76.511 67.627 10.685 4.615 19.028 7.371 25.533 9.434 10.728 3.41 20.492 2.929 28.209 1.775 8.605-1.285 26.499-10.833 30.231-21.295 3.732-10.464 3.732-19.431 2.612-21.298-1.119-1.869-4.105-2.99-8.583-5.232z"/></svg></a><a target=_blank rel="noopener noreferrer" aria-label="share Nodejs 프로젝트 적응기 on telegram" href="https://telegram.me/share/url?text=Nodejs%20%ed%94%84%eb%a1%9c%ec%a0%9d%ed%8a%b8%20%ec%a0%81%ec%9d%91%ea%b8%b0&url=https%3a%2f%2fhaservi.github.io%2fposts%2fnodejs%2fstart-nodejs%2f"><svg viewBox="2 2 28 28" height="30" width="30" fill="currentcolor"><path d="M26.49 29.86H5.5a3.37 3.37.0 01-2.47-1 3.35 3.35.0 01-1-2.47V5.48A3.36 3.36.0 013 3 3.37 3.37.0 015.5 2h21A3.38 3.38.0 0129 3a3.36 3.36.0 011 2.46V26.37a3.35 3.35.0 01-1 2.47 3.38 3.38.0 01-2.51 1.02zm-5.38-6.71a.79.79.0 00.85-.66L24.73 9.24a.55.55.0 00-.18-.46.62.62.0 00-.41-.17q-.08.0-16.53 6.11a.59.59.0 00-.41.59.57.57.0 00.43.52l4 1.24 1.61 4.83a.62.62.0 00.63.43.56.56.0 00.4-.17L16.54 20l4.09 3A.9.9.0 0021.11 23.15zM13.8 20.71l-1.21-4q8.72-5.55 8.78-5.55c.15.0.23.0.23.16a.18.18.0 010 .06s-2.51 2.3-7.52 6.8z"/></svg></a><a target=_blank rel="noopener noreferrer" aria-label="share Nodejs 프로젝트 적응기 on ycombinator" href="https://news.ycombinator.com/submitlink?t=Nodejs%20%ed%94%84%eb%a1%9c%ec%a0%9d%ed%8a%b8%20%ec%a0%81%ec%9d%91%ea%b8%b0&u=https%3a%2f%2fhaservi.github.io%2fposts%2fnodejs%2fstart-nodejs%2f"><svg width="30" height="30" viewBox="0 0 512 512" fill="currentcolor" xmlns:inkscape="http://www.inkscape.org/namespaces/inkscape"><path d="M449.446.0C483.971.0 512 28.03 512 62.554V449.446C512 483.97 483.97 512 449.446 512H62.554C28.03 512 0 483.97.0 449.446V62.554C0 28.03 28.029.0 62.554.0H449.446zM183.8767 87.9921h-62.034L230.6673 292.4508V424.0079h50.6655V292.4508L390.1575 87.9921H328.1233L256 238.2489z"/></svg></a></div></footer><section class=comments><script>loadComment();function loadComment(){document.body.className.includes("dark")?theme="photon-dark":theme="boxy-light";let e=document.createElement("script");e.src="https://utteranc.es/client.js",e.setAttribute("repo","haservi/haservi.github.io"),e.setAttribute("issue-term","pathname"),e.setAttribute("theme",theme),e.setAttribute("crossorigin","anonymous"),e.setAttribute("async",""),document.querySelector("section.comments").innerHTML="",document.querySelector("section.comments").appendChild(e)}</script></section></article></main><footer class=footer><span>&copy; 2025 <a href=https://haservi.github.io/>Halog</a></span>
<span>Powered by
<a href=https://gohugo.io/ rel="noopener noreferrer" target=_blank>Hugo</a> &
        <a href=https://github.com/adityatelange/hugo-PaperMod/ rel=noopener target=_blank>PaperMod</a></span></footer><a href=#top aria-label="go to top" title="Go to Top (Alt + G)" class=top-link id=top-link accesskey=g><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 12 6" fill="currentcolor"><path d="M12 6H0l6-6z"/></svg></a><script src=https://cdnjs.cloudflare.com/ajax/libs/medium-zoom/1.0.6/medium-zoom.min.js integrity="sha512-N9IJRoc3LaP3NDoiGkcPa4gG94kapGpaA5Zq9/Dr04uf5TbLFU5q0o8AbRhLKUUlp8QFS2u7S+Yti0U7QtuZvQ==" crossorigin=anonymous referrerpolicy=no-referrer></script>
<script>const images=Array.from(document.querySelectorAll(".post-content img"));images.forEach(e=>{mediumZoom(e,{margin:0,background:"#1d1e20",scrollOffset:40,container:null,template:null})})</script><script>let menu=document.getElementById("menu");menu&&(menu.scrollLeft=localStorage.getItem("menu-scroll-position"),menu.onscroll=function(){localStorage.setItem("menu-scroll-position",menu.scrollLeft)}),document.querySelectorAll('a[href^="#"]').forEach(e=>{e.addEventListener("click",function(e){e.preventDefault();var t=this.getAttribute("href").substr(1);window.matchMedia("(prefers-reduced-motion: reduce)").matches?document.querySelector(`[id='${decodeURIComponent(t)}']`).scrollIntoView():document.querySelector(`[id='${decodeURIComponent(t)}']`).scrollIntoView({behavior:"smooth"}),t==="top"?history.replaceState(null,null," "):history.pushState(null,null,`#${t}`)})})</script><script>var mybutton=document.getElementById("top-link");window.onscroll=function(){document.body.scrollTop>800||document.documentElement.scrollTop>800?(mybutton.style.visibility="visible",mybutton.style.opacity="1"):(mybutton.style.visibility="hidden",mybutton.style.opacity="0")}</script><script>document.getElementById("theme-toggle").addEventListener("click",()=>{document.body.className.includes("dark")?(document.body.classList.remove("dark"),localStorage.setItem("pref-theme","light")):(document.body.classList.add("dark"),localStorage.setItem("pref-theme","dark")),loadComment()})</script><script>document.querySelectorAll("pre > code").forEach(e=>{const n=e.parentNode.parentNode,t=document.createElement("button");t.classList.add("copy-code"),t.innerHTML="복사";function s(){t.innerHTML="복사 완료!",setTimeout(()=>{t.innerHTML="복사"},2e3)}t.addEventListener("click",t=>{if("clipboard"in navigator){navigator.clipboard.writeText(e.textContent),s();return}const n=document.createRange();n.selectNodeContents(e);const o=window.getSelection();o.removeAllRanges(),o.addRange(n);try{document.execCommand("copy"),s()}catch{}o.removeRange(n)}),n.classList.contains("highlight")?n.appendChild(t):n.parentNode.firstChild==n||(e.parentNode.parentNode.parentNode.parentNode.parentNode.nodeName=="TABLE"?e.parentNode.parentNode.parentNode.parentNode.parentNode.appendChild(t):e.parentNode.appendChild(t))})</script></body></html>